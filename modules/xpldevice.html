<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
    <title>Reference</title>
    <link rel="stylesheet" href="../luadoc.css" type="text/css" />
	<!--meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/-->
</head>

<body>
<div id="container">

<div id="product">
	<div id="product_logo"></div>
	<div id="product_name"><big><b></b></big></div>
	<div id="product_description"></div>
</div> <!-- id="product" -->

<div id="main">

<div id="navigation">


<h1>LuaDoc</h1>
<ul>
	
	<li><a href="../index.html">Index</a></li>
	
</ul>


<!-- Module list -->

<h1>Modules</h1>
<ul>

	<li>
		<a href="../modules/xpl.html">xpl</a>
	</li>

	<li><strong>xpldevice</strong></li>
	
	<li>
		<a href="../modules/xplfilters.html">xplfilters</a>
	</li>

	<li>
		<a href="../modules/xplhub.html">xplhub</a>
	</li>

	<li>
		<a href="../modules/xpllistener.html">xpllistener</a>
	</li>

	<li>
		<a href="../modules/xpllogger.html">xpllogger</a>
	</li>

	<li>
		<a href="../modules/xplmessage.html">xplmessage</a>
	</li>

	<li>
		<a href="../modules/xplnetpresence.html">xplnetpresence</a>
	</li>

	<li>
		<a href="../modules/xplsender.html">xplsender</a>
	</li>

</ul>



<!-- File list -->

<h1>Files</h1>
<ul>

	<li>
		<a href="../files/src/xpl/classes/base.html">src/xpl/classes/base.lua</a>
	</li>

	<li>
		<a href="../files/src/xpl/classes/xpldevice.html">src/xpl/classes/xpldevice.lua</a>
	</li>

	<li>
		<a href="../files/src/xpl/classes/xplfilter.html">src/xpl/classes/xplfilter.lua</a>
	</li>

	<li>
		<a href="../files/src/xpl/classes/xplmessage.html">src/xpl/classes/xplmessage.lua</a>
	</li>

	<li>
		<a href="../files/src/xpl/init.html">src/xpl/init.lua</a>
	</li>

	<li>
		<a href="../files/src/xpl/new_device_template.html">src/xpl/new_device_template.lua</a>
	</li>

	<li>
		<a href="../files/src/xpl/xplhub.html">src/xpl/xplhub.lua</a>
	</li>

	<li>
		<a href="../files/src/xpl/xpllistener.html">src/xpl/xpllistener.lua</a>
	</li>

	<li>
		<a href="../files/src/xpllogger.html">src/xpllogger.lua</a>
	</li>

	<li>
		<a href="../files/src/xplnetpres_conf.html">src/xplnetpres_conf.lua</a>
	</li>

	<li>
		<a href="../files/src/xplnetpresence.html">src/xplnetpresence.lua</a>
	</li>

	<li>
		<a href="../files/src/xplrun.html">src/xplrun.lua</a>
	</li>

	<li>
		<a href="../files/src/xplrun_config.html">src/xplrun_config.lua</a>
	</li>

	<li>
		<a href="../files/src/xplsender.html">src/xplsender.lua</a>
	</li>

</ul>






</div><!-- id="navigation" -->

<div id="content">

<h1>Module <code>xpldevice</code></h1>

<p>The base object for xPL devices. It features all the main characteristics of the xPL devices, so only user code needs to be added. Starting, stopping, regular heartbeats, configuration has all been implemented in this base class.<br/>&nbsp<br/>No global will be created, it just returns the xpldevice base class. The main xPL module will create a global <code>xpl.classes.xpldevice</code> to access it.<br/>&nbsp<br/>You can create a new device from; <code>xpl.classes.xpldevice:new( {} )</code>, but it is probably best to use the <a href="../files/src/xpl/new_device_template.html">new_device_template.lua</a> file as an example on how to use the <code>xpldevice</code> class</p>

<p>Copyright &copy; 2011 Thijs Schreijer</p>




<p><b>Release:</b> Version 0.1, LuaxPL framework.
</p>



<h2>Functions</h2>
<table class="function_list">

	<tr>
	<td class="name" nowrap><a href="#xpldevice:createhbeatmsg">xpldevice:createhbeatmsg</a>&nbsp;(exit)</td>
	<td class="summary">Heartbeat message creator.</td>
	</tr>

	<tr>
	<td class="name" nowrap><a href="#xpldevice:eventhandler">xpldevice:eventhandler</a>&nbsp;(sender, event, param, ...)</td>
	<td class="summary">Handles incoming events.</td>
	</tr>

	<tr>
	<td class="name" nowrap><a href="#xpldevice:getsettings">xpldevice:getsettings</a>&nbsp;()</td>
	<td class="summary">Gets a table with the device settings to persist.</td>
	</tr>

	<tr>
	<td class="name" nowrap><a href="#xpldevice:handlemessage">xpldevice:handlemessage</a>&nbsp;(msg)</td>
	<td class="summary">Handler for incoming messages.</td>
	</tr>

	<tr>
	<td class="name" nowrap><a href="#xpldevice:initialize">xpldevice:initialize</a>&nbsp;()</td>
	<td class="summary">Initializes the xpldevice.</td>
	</tr>

	<tr>
	<td class="name" nowrap><a href="#xpldevice:restart">xpldevice:restart</a>&nbsp;()</td>
	<td class="summary">Restarts the xpldevice (only if already started, remains stopped otherwise).</td>
	</tr>

	<tr>
	<td class="name" nowrap><a href="#xpldevice:send">xpldevice:send</a>&nbsp;(msg)</td>
	<td class="summary">Sends xpl message.</td>
	</tr>

	<tr>
	<td class="name" nowrap><a href="#xpldevice:sendhbeat">xpldevice:sendhbeat</a>&nbsp;(exit)</td>
	<td class="summary">Sends heartbeat message.</td>
	</tr>

	<tr>
	<td class="name" nowrap><a href="#xpldevice:setsettings">xpldevice:setsettings</a>&nbsp;(s)</td>
	<td class="summary">Sets the provided settings in the device.</td>
	</tr>

	<tr>
	<td class="name" nowrap><a href="#xpldevice:start">xpldevice:start</a>&nbsp;()</td>
	<td class="summary">Starts the xpldevice.</td>
	</tr>

	<tr>
	<td class="name" nowrap><a href="#xpldevice:statuschanged">xpldevice:statuschanged</a>&nbsp;(newstatus, oldstatus)</td>
	<td class="summary">Handler called whenever the device status (either <code>"online", "connecting"</code> or <code>"offline"</code>) changes.</td>
	</tr>

	<tr>
	<td class="name" nowrap><a href="#xpldevice:stop">xpldevice:stop</a>&nbsp;()</td>
	<td class="summary">Stops the xpldevice.</td>
	</tr>

</table>



<h2>Tables</h2>
<table class="table_list">

	<tr>
	<td class="name" nowrap><a href="#xpldevice fields/properties">xpldevice fields/properties</a></td>
	<td class="summary">Members of the xpldevice object </td>
	</tr>

</table>



<br/>
<br/>



<h2><a name="functions"></a>Functions</h2>
<dl class="function">



<dt><a name="xpldevice:createhbeatmsg"></a><strong>xpldevice:createhbeatmsg</strong>&nbsp;(exit)</dt>
<dd>
Heartbeat message creator. Will be called to create the heartbeat message to be send. Override this function to modify the hbeat content.


<h3>Parameters:</h3>
<ul>
	
	<li>
	  <code><em>exit</em></code>: if <code>true</code> then an exit hbeat message, (<code>hbeat.end</code> or <code>config.end</code>) needs to be created.
	</li>
	
</ul>






<h3>Return value:</h3>
<ul><a href="xplmessage.html">xplmessage object</a> with the heartbeat message to be sent.</ul>



</dd>




<dt><a name="xpldevice:eventhandler"></a><strong>xpldevice:eventhandler</strong>&nbsp;(sender, event, param, ...)</dt>
<dd>
Handles incoming events. Will deal with copas starting/stopping and listener messages. See CopasTimer documentation on how to use the events.


<h3>Parameters:</h3>
<ul>
	
	<li>
	  <code><em>sender</em></code>: the originator of the event
	</li>
	
	<li>
	  <code><em>event</em></code>: the event string
	</li>
	
	<li>
	  <code><em>param</em></code>: first event parameter, in case of an <code>xpllistener</code> event <code>newmessage</code> this will for example be the xplmessage received.
	</li>
	
	<li>
	  <code><em>...</em></code>: any additional event parameters
	</li>
	
</ul>








</dd>




<dt><a name="xpldevice:getsettings"></a><strong>xpldevice:getsettings</strong>&nbsp;()</dt>
<dd>
Gets a table with the device settings to persist. Override this function to add additional settings. All xpl config items in the <code>configitems</code> table will be included automatically by the base class.







<h3>Return value:</h3>
<ul>table with settings</ul>



<h3>See also:</h3>
<ul>
	
	<!-- <li><a href="#xpldevice:setsettings"> -->
	<li><a href="#xpldevice:setsettings">
		xpldevice:setsettings</li>
	</a>
	
</ul>

</dd>




<dt><a name="xpldevice:handlemessage"></a><strong>xpldevice:handlemessage</strong>&nbsp;(msg)</dt>
<dd>
Handler for incoming messages. It will handle the heartbeat messages (echos) to verify the devices own connection and heartbeat requests. If the device is configurable it will also deal with the configuration messages.<br/>&nbspOverride this method to handle incoming messages, see the <a href="../files/src/xpl/new_device_template.html">new_device_template.lua</a> for an example.


<h3>Parameters:</h3>
<ul>
	
	<li>
	  <code><em>msg</em></code>: the <a href="xplmessage.html">xplmessage object</a> to be handled
	</li>
	
</ul>






<h3>Return value:</h3>
<ul>the <a href="xplmessage.html">xplmessage object</a> received, or <code>nil</code> if it was handled (eg hbeat, our own echo, etc.)</ul>



</dd>




<dt><a name="xpldevice:initialize"></a><strong>xpldevice:initialize</strong>&nbsp;()</dt>
<dd>
Initializes the xpldevice. Will be called upon instantiation of an object, override this method to set default values for all properties. It will also subscribe to <code>copas</code> and <code>xpl.listener</code> events for starting, stopping and new message events. Use <code>setsettings()</code> to restore settings from persistence.









<h3>See also:</h3>
<ul>
	
	<!-- <li><a href="#xpldevice:setsettings"> -->
	<li><a href="#xpldevice:setsettings">
		xpldevice:setsettings</li>
	</a>
	
	<!-- <li><a href="#xpldevice:eventhandler"> -->
	<li><a href="#xpldevice:eventhandler">
		xpldevice:eventhandler</li>
	</a>
	
</ul>

</dd>




<dt><a name="xpldevice:restart"></a><strong>xpldevice:restart</strong>&nbsp;()</dt>
<dd>
Restarts the xpldevice (only if already started, remains stopped otherwise). Use this method after configuration changes that require a device restart.









<h3>See also:</h3>
<ul>
	
	<!-- <li><a href="#xpldevice:setsettings"> -->
	<li><a href="#xpldevice:setsettings">
		xpldevice:setsettings</li>
	</a>
	
</ul>

</dd>




<dt><a name="xpldevice:send"></a><strong>xpldevice:send</strong>&nbsp;(msg)</dt>
<dd>
Sends xpl message. Will send either a <code>string</code> or an <a href="xplmessage.html">xplmessage object</a>. In the latter case it will set the <code>source</code> property to the address of the device sending.


<h3>Parameters:</h3>
<ul>
	
	<li>
	  <code><em>msg</em></code>: message to send
	</li>
	
</ul>








</dd>




<dt><a name="xpldevice:sendhbeat"></a><strong>xpldevice:sendhbeat</strong>&nbsp;(exit)</dt>
<dd>
Sends heartbeat message. Will send a heartbeat message, the message will be collected from the <code>createhbeatmsg()</code> function.


<h3>Parameters:</h3>
<ul>
	
	<li>
	  <code><em>exit</em></code>: if <code>true</code> then an exit hbeat message (<code>hbeat.end</code> or <code>config.end</code>) will be send.
	</li>
	
</ul>








<h3>See also:</h3>
<ul>
	
	<!-- <li><a href="#xpldevice:createhbeatmsg"> -->
	<li><a href="#xpldevice:createhbeatmsg">
		xpldevice:createhbeatmsg</li>
	</a>
	
</ul>

</dd>




<dt><a name="xpldevice:setsettings"></a><strong>xpldevice:setsettings</strong>&nbsp;(s)</dt>
<dd>
Sets the provided settings in the device. Override this method to add additional settings


<h3>Parameters:</h3>
<ul>
	
	<li>
	  <code><em>s</em></code>: table with settings as generated by <code>getsettings()</code>.
	</li>
	
</ul>




<h3>Usage:</h3>
<ul><pre class=example>if mydev:setsettings(mysettings) then mydev:restart() end</pre></ul>



<h3>Return value:</h3>
<ul><code>true</code> if the settings provided require a restart of the device (when the instance name changed for example). Make sure to call <code>restart()</code> in that case.</ul>



<h3>See also:</h3>
<ul>
	
	<!-- <li><a href="#xpldevice:restart"> -->
	<li><a href="#xpldevice:restart">
		xpldevice:restart</li>
	</a>
	
	<!-- <li><a href="#xpldevice:getsettings"> -->
	<li><a href="#xpldevice:getsettings">
		xpldevice:getsettings</li>
	</a>
	
</ul>

</dd>




<dt><a name="xpldevice:start"></a><strong>xpldevice:start</strong>&nbsp;()</dt>
<dd>
Starts the xpldevice. Will run on the copas start event.









<h3>See also:</h3>
<ul>
	
	<!-- <li><a href="#xpldevice:eventhandler"> -->
	<li><a href="#xpldevice:eventhandler">
		xpldevice:eventhandler</li>
	</a>
	
</ul>

</dd>




<dt><a name="xpldevice:statuschanged"></a><strong>xpldevice:statuschanged</strong>&nbsp;(newstatus, oldstatus)</dt>
<dd>
Handler called whenever the device status (either <code>"online", "connecting"</code> or <code>"offline"</code>) changes. Override this method to implement code upon status changes.


<h3>Parameters:</h3>
<ul>
	
	<li>
	  <code><em>newstatus</em></code>: the new status of the device
	</li>
	
	<li>
	  <code><em>oldstatus</em></code>: the previous status
	</li>
	
</ul>








</dd>




<dt><a name="xpldevice:stop"></a><strong>xpldevice:stop</strong>&nbsp;()</dt>
<dd>
Stops the xpldevice. Will run on the copas stop event.









<h3>See also:</h3>
<ul>
	
	<!-- <li><a href="#xpldevice:eventhandler"> -->
	<li><a href="#xpldevice:eventhandler">
		xpldevice:eventhandler</li>
	</a>
	
</ul>

</dd>


</dl>




<h2><a name="tables"></a>Tables</h2>
<dl class="table">

<dt><a name="xpldevice fields/properties"></a><strong>xpldevice fields/properties</strong></dt>
<dd>Members of the xpldevice object<br /><br />


<h3>Fields:</h3>
<ul>
	
	<li>
	  <code><em>address</em></code>: (string) the xpladdress of the device
	</li>
	
	<li>
	  <code><em>interval</em></code>: (number) the xpl heartbeat interval in minutes
	</li>
	
	<li>
	  <code><em>status</em></code>: (string) current status of the connection for this device; <code>"online", "connecting", "offline"</code>
	</li>
	
	<li>
	  <code><em>filter</em></code>: either <code>nil</code> or the <a href="xplfilters.html">xplfilters object</a> with the filter list for the device
	</li>
	
	<li>
	  <code><em>classname</em></code>: (string) the name of this class, basically the filename without the extension. Required to identify the type of class, but also to re-create a device from persistence.
	</li>
	
	<li>
	  <code><em>configitems</em></code>: table to hold the current config items, will start with the regular xPL config items; newconf, interval, filters, groups
	</li>
	
	<li>
	  <code><em>configurable</em></code>: (boolean) if <code>false</code> the device will not respond to configuration messages
	</li>
	
	<li>
	  <code><em>configured</em></code>: (boolean) <code>true</code> if the device has been configured
	</li>
	
	<li>
	  <code><em>version</em></code>: (string) a version number to report in the hearbeat messages, set to <code>nil</code> to not report a version
	</li>
	
</ul>


</dd>


</dl>



</div> <!-- id="content" -->

</div> <!-- id="main" -->

<div id="about">
	<p><a href="http://validator.w3.org/check?uri=referer"><img src="http://www.w3.org/Icons/valid-xhtml10" alt="Valid XHTML 1.0!" height="31" width="88" /></a></p>
</div> <!-- id="about" -->

</div> <!-- id="container" -->	
</body>
</html>
